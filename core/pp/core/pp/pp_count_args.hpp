//
// Created by doom on 03/10/17.
//

#ifndef CORE_PP_COUNT_ARGS_HPP
#define CORE_PP_COUNT_ARGS_HPP

#include <cstddef>

#if 0
namespace pp::details
{
    constexpr unsigned int count_args(const char *arr, unsigned int idx, unsigned int acc)
    {
        return arr[idx] != '\0' ?
               count_args(arr, idx + 1, (arr[idx] == ',' ? acc + 1 : acc))
               : (idx == 0 ? 0 : acc + 1);
    }
}

#define pp_count_args(...)      pp::details::count_args(#__VA_ARGS__, 0, 0)
#endif

#ifdef _MSC_VER
#define __ADD_UNUSED(...) unused, __VA_ARGS__

#define __COUNT_ARGS_EXPAND(x) x

#define __EXPAND_ARGS_PRIVATE(...)  __COUNT_ARGS_EXPAND(__GET_ARG_COUNT_PRIVATE(__VA_ARGS__, \
                                                                                124, 123, 122, 121, 120, 119, 118, \
                                                                                117, 116, 115, 114, 113, 112, 111, \
                                                                                110, 109, 108, 107, 106, 105, 104, \
                                                                                103, 102, 101, 100, 99, 98, 97, 96, \
                                                                                95, 94, 93, 92, 91, 90, 89, 88, 87, \
                                                                                86, 85, 84, 83, 82, 81, 80, 79, 78, \
                                                                                77, 76, 75, 74, 73, 72, 71, 70, 69, \
                                                                                68, 67, 66, 65, 64, 63, 62, 61, 60, \
                                                                                59, 58, 57, 56, 55, 54, 53, 52, 51, \
                                                                                50, 49, 48, 47, 46, 45, 44, 43, 42, \
                                                                                41, 40, 39, 38, 37, 36, 35, 34, 33, \
                                                                                32, 31, 30, 29, 28, 27, 26, 25, 24, \
                                                                                23, 22, 21, 20, 19, 18, 17, 16, 15, \
                                                                                14, 13, 12, 11, 10, 9, 8, 7, 6, 5, \
                                                                                4, 3, 2, 1, 0))

#define __GET_ARG_COUNT_PRIVATE(_1, _2, _3, _4, _5, _6, _7, _8, _9, _10, _11, _12, _13, _14, _15, _16, _17, _18, \
                                _19, _20, _21, _22, _23, _24, _25, _26, _27, _28, _29, _30, _31, _32, _33, _34, \
                                _35, _36, _37, _38, _39, _40, _41, _42, _43, _44, _45, _46, _47, _48, _49, _50, \
                                _51, _52, _53, _54, _55, _56, _57, _58, _59, _60, _61, _62, _63, _64, _65, _66, \
                                _67, _68, _69, _70, _71, _72, _73, _74, _75, _76, _77, _78, _79, _80, _81, _82, \
                                _83, _84, _85, _86, _87, _88, _89, _90, _91, _92, _93, _94, _95, _96, _97, _98, \
                                _99, _100, _101, _102, _103, _104, _105, _106, _107, _108, _109, _110, _111, \
                                _112, _113, _114, _115, _116, _117, _118, _119, _120, _121, _122, _123, _124, \
                                _125, \
                                 count, ...)  count

#define pp_count_args(...)      __EXPAND_ARGS_PRIVATE(__ADD_UNUSED(__VA_ARGS__))

#else

#define __COUNT_ARGS_HELPER64(_p0, _p1, _p2, _p3, _p4, _p5, _p6, _p7, _p8, _p9, _p10, _p11, _p12, _p13, _p14, \
                              _p15, _p16, _p17, _p18, _p19, _p20, _p21, _p22, _p23, _p24, _p25, _p26, _p27, _p28, \
                              _p29, _p30, _p31, _p32, _p33, _p34, _p35, _p36, _p37, _p38, _p39, _p40, _p41, _p42, \
                              _p43, _p44, _p45, _p46, _p47, _p48, _p49, _p50, _p51, _p52, _p53, _p54, _p55, _p56, \
                              _p57, _p58, _p59, _p60, _p61, _p62, _p63, _p64, _p65, _p66, _p67, _p68, _p69, _p70, \
                              _p71, _p72, _p73, _p74, _p75, _p76, _p77, _p78, _p79, _p80, _p81, _p82, _p83, _p84, \
                              _p85, _p86, _p87, _p88, _p89, _p90, _p91, _p92, _p93, _p94, _p95, _p96, _p97, _p98, \
                              _p99, _p100, _p101, _p102, _p103, _p104, _p105, _p106, _p107, _p108, _p109, _p110, \
                              _p111, _p112, _p113, _p114, _p115, _p116, _p117, _p118, _p119, _p120, _p121, _p122, \
                              _p123, _p124, _p125, _p126, _p127, _p128, _p129, _p130, _p131, _p132, _p133, _p134, \
                              _p135, _p136, _p137, _p138, _p139, _p140, _p141, _p142, _p143, _p144, _p145, _p146, \
                              _p147, _p148, _p149, n, ...) n

#define pp_count_args(...)   __COUNT_ARGS_HELPER64(__VA_ARGS__, 150, 149, 148, 147, 146, 145, 144, 143, 142, 141, \
                                                            140, 139, 138, 137, 136, 135, 134, 133, 132, 131, 130, \
                                                            129, 128, 127, 126, 125, 124, 123, 122, 121, 120, 119, \
                                                            118, 117, 116, 115, 114, 113, 112, 111, 110, 109, 108, \
                                                            107, 106, 105, 104, 103, 102, 101,100, 99, 98, 97, 96, \
                                                            95, 94, 93, 92, 91, 90, 89, 88, 87, 86, 85, 84, 83, 82, \
                                                            81, 80, 79, 78, 77, 76, 75, 74, 73, 72, 71, 70, 69, 68, \
                                                            67, 66, 65, 64, 63, 62, 61, 60, 59, 58, 57, 56, 55, 54, \
                                                            53, 52, 51, 50, 49, 48, 47, 46, 45, 44, 43, 42, 41, 40, \
                                                            39, 38, 37, 36, 35, 34, 33, 32, 31, 30, 29, 28, 27, 26, \
                                                            25, 24, 23, 22, 21, 20, 19, 18, 17, 16, 15, 14, 13, 12, \
                                                            11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1)

#endif

#endif //CORE_PP_COUNT_ARGS_HPP
